jQuery(document).ready(function(){function e(e){if((e=e||event).dataTransfer.types)for(var t=0;t<e.dataTransfer.types.length;t++)if("Files"==e.dataTransfer.types[t]){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="none";break}}function t(e){if((e=e||event).originalEvent.dataTransfer.types)for(var t=0;t<e.originalEvent.dataTransfer.types.length;t++)if("Files"==e.originalEvent.dataTransfer.types[t])return e.stopPropagation(),e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="move",!1}jQuery(".cb-ids").change(function(){jQuery(this).is(":checked")?jQuery(this).closest("tr").addClass("selected"):jQuery(this).closest("tr").removeClass("selected")}),jQuery("th input:checkbox").change(function(){jQuery(this).is(":checked")?jQuery("#ThumbsTable tbody tr").addClass("selected"):jQuery("#ThumbsTable tbody tr").removeClass("selected")}),jQuery("input.current-page").bind("keypress",{},function(e){13==(e.keyCode?e.keyCode:e.which)&&(e.preventDefault(),jQuery(location).attr("href","?"+jQuery.param(jQuery.extend(URL_params,{sheet:this.value}))))}),jQuery("select.limit_per_page").change(function(){jQuery(location).attr("href","?"+jQuery.param(jQuery.extend(URL_params,{limit:this.value})))}),jQuery("#thumbnail-management-tab").submit(function(e){if(e.preventDefault(),jQuery(".cb-ids:checked").length>0){var t=jQuery(this).attr("action"),a=jQuery(this).serialize()+"&document_gallery%5Bajax%5D=true&document_gallery%5Bcleanup%5D=true";jQuery(".deleteSelected").addClass("waiting").attr("disabled","disabled"),jQuery.post(t,a,function(e){if(e.result){var t=e.deleted;for(var a in t)jQuery("input[type=checkbox][value="+t[a]+"]").closest("tr").fadeOut("slow",0,function(){jQuery(this).slideUp("slow",function(){jQuery(this).remove()})})}jQuery(".deleteSelected").removeClass("waiting").removeAttr("disabled")}).fail(function(){console.log("Problem in reaching the server"),jQuery(".deleteSelected").removeClass("waiting").removeAttr("disabled")})}return!1}),jQuery("#advanced-tab #options-dump").click(function(){jQuery(this).select()}),jQuery(".expander").click(function(){getSelection().toString()||(jQuery(this).next().slideToggle("slow"),jQuery(this).find(".dashicons").toggleClass("dashicons-arrow-down-alt2 dashicons-arrow-up-alt2"),jQuery(this).toggleClass("expander collapser"),jQuery(this).attr("title",jQuery(this).hasClass("expander")?"Click to Expand":"Click to Collapse"))}),jQuery(".spoiler-body").length&&(jQuery(".expandAll, .collapseAll").addClass("button"),jQuery(".expandAll").click(function(e){e.preventDefault(),jQuery(".expander").trigger("click")}),jQuery(".collapseAll").click(function(e){e.preventDefault(),jQuery(".collapser").trigger("click")})),jQuery(".levelSelector input").change(function(){"all"==jQuery(this).val()?(jQuery(".levelSelector input").not("[value='all']").prop("checked",jQuery(this).is(":checked")),jQuery(this).is(":checked")?jQuery("#LogTable tbody tr").show():jQuery("#LogTable tbody tr").hide()):(jQuery(this).is(":checked")?jQuery("#LogTable tbody tr:has(span."+jQuery(this).val()+")").show():jQuery("#LogTable tbody tr:has(span."+jQuery(this).val()+")").hide(),jQuery(".levelSelector input:checked").not("[value='all']").length+1==jQuery('.levelSelector input[type="checkbox"]').length?jQuery('.levelSelector input[value="all"]').prop("checked",!0):jQuery('.levelSelector input[value="all"]').prop("checked",!1))}),jQuery("#LogTable .manage-column.column-date").click(function(){jQuery(this).toggleClass("asc desc");var e=jQuery("#LogTable > tbody"),t=e.children("tr");e.append(t.get().reverse())}),window.addEventListener("dragover",e,!1),window.addEventListener("drop",e,!1);var a={};function n(e){if((e=e||event).originalEvent.dataTransfer.types)for(var t=0;t<e.originalEvent.dataTransfer.types.length;t++)if("Files"==e.originalEvent.dataTransfer.types[t]){this.classList.add("dragover"),a[jQuery(this).data("entry")]=a[jQuery(this).data("entry")].add(jQuery(e.target));break}}function r(e){if((e=e||event).originalEvent.dataTransfer.types)for(var t=0;t<e.originalEvent.dataTransfer.types.length;t++)if("Files"==e.originalEvent.dataTransfer.types[t]){a[jQuery(this).data("entry")]=a[jQuery(this).data("entry")].not(e.target),0===a[jQuery(this).data("entry")].length&&this.classList.remove("dragover");break}}function s(e){if((e=e||event).originalEvent.dataTransfer.types)for(var t=0;t<e.originalEvent.dataTransfer.types.length;t++)if("Files"==e.originalEvent.dataTransfer.types[t]){e.stopPropagation(),e.preventDefault(),l(e.originalEvent.dataTransfer.files,jQuery(this).data("entry")),a[jQuery(this).data("entry")]=jQuery(),this.classList.remove("dragover");break}}function i(e){l((e=e||event).target.files,jQuery(this).closest("tr").data("entry"))}function l(e,t){for(var a,n=0;a=e[n];n++){if(0==a.type.indexOf("image/")&&void 0!==dg_admin_vars.upload_limit&&a.size<=parseInt(dg_admin_vars.upload_limit)){var r,s=jQuery("[data-entry="+t+"]"),i=new FormData(s.closest("form")[0]),l=jQuery("#thumbnail-management-tab");l.length?r=l.attr("action"):(r=ajaxurl,i.append("action","dg_upload_thumb")),i.append("document_gallery[entry]",t),i.append("document_gallery[ajax]","true"),i.append("document_gallery[upload]","true"),i.append("file",a);var o=new XMLHttpRequest;o.open("POST",r);var d=s.find(".column-icon img"),u=s.find(".progress > *:first");o.onreadystatechange=function(){if(4==o.readyState){if(200==o.status&&-1==o.responseText.indexOf("\n")){jQuery(u).parent().addClass("success");var e=jQuery.parseJSON(o.responseText);e.result&&(e.url===d.attr("src")?d.attr("src",d.attr("src")+"?"+(new Date).getTime()):d.attr("src",e.url))}else jQuery(u).parent().addClass("fail"),console.log("Invalid response from server:"),console.log(o.responseText);setTimeout(function(){s.find(".column-thumbupload > *").toggleClass("invis"),jQuery(u).parent().removeClass("success fail")},5e3)}},o.onload=function(){u.width("100%")},o.upload.onprogress=function(e){if(e.lengthComputable){var t=e.loaded/e.total*100|0;u.width(t+"%")}},u.width(0),s.find(".column-thumbupload > *").toggleClass("invis"),o.send(i);break}console.log("Attempt to upload improper file %c"+a.name+":","font-weight:bold;"),0!=a.type.indexOf("image/")&&console.log("\tIs not an image - "+a.type),void 0!==dg_admin_vars.upload_limit&&a.size>parseInt(dg_admin_vars.upload_limit)&&console.log("\tIs too big - "+a.size+"b; (Limit is "+dg_admin_vars.upload_limit+"b)")}}function o(e){for(var t=4,a=0;a<6;a++)e.animate({"margin-left":"+="+(t=-t)+"px"},50)}jQuery("#ThumbsTable tbody tr").each(function(){jQuery(this).on("dragenter",n).on("dragover",t).on("dragleave",r).on("drop",s),a[jQuery(this).data("entry")]=jQuery(),jQuery(this).find("input:button").on("click",function(){jQuery(this).prevAll("input:file").click()}),jQuery(this).find("input:file").on("change",i)}),"draggable"in document.createElement("span")||jQuery(".html5dndmarker").hide(),jQuery("td .dashicons-edit").click(function(){var e=jQuery(this).closest("td");if(e.hasClass("column-title")){if("none"==e.find("a").css("display"))return;e.find("a").hide().after('<input type="text" value="'+e.find(".editable-title").text()+'">'),e.find("input").focus()}else{if(!e.hasClass("column-description"))return;if("none"==e.find(".editable-description").css("display"))return;e.find(".editable-description").hide().after("<textarea>"+e.find(".editable-description").html()+"</textarea>"),e.find("textarea").focus()}jQuery(this).css("visibility","hidden"),e.find(".edit-controls").show()}),jQuery(".edit-controls .dashicons-no").click(function(){var e=jQuery(this).closest("td");if(e.hasClass("column-title")){if("none"!=e.find("a").css("display"))return;e.find("input").fadeOut("fast",function(){jQuery(this).remove(),e.find("a").fadeIn("fast")})}else{if(!e.hasClass("column-description"))return;if("none"!=e.find(".editable-description").css("display"))return;e.find("textarea").fadeOut("fast",function(){jQuery(this).remove(),e.find(".editable-description").fadeIn("fast")})}jQuery(this).closest(".edit-controls").hide(),e.find(".dashicons-edit").css("visibility","visible")}),jQuery(".edit-controls .dashicons-yes").click(function(){var e,t,a=jQuery(this).closest("td"),n=jQuery(this).closest("tr").data("entry"),r=jQuery("#thumbnail-management-tab").attr("action"),s=new FormData(jQuery("[data-entry="+n+"]").closest("form")[0]);if(s.append("document_gallery[entry]",n),s.append("document_gallery[ajax]","true"),a.hasClass("column-title"))e=a.find("input"),t=a.find(".editable-title"),s.append("document_gallery[title]",encodeURIComponent(e.val()));else{if(!a.hasClass("column-description"))return;e=a.find("textarea"),t=a.find(".editable-description"),s.append("document_gallery[description]",encodeURIComponent(e.val()))}if(e.val()==t.text()||a.hasClass("column-description")&&e.val()==t.html())jQuery(this).next(".dashicons-no").click();else{var i=new XMLHttpRequest;i.open("POST",r),i.onreadystatechange=function(){4==i.readyState&&(a.addClass("trans"),a.find(".edit-controls").removeClass("waiting"),-1==i.responseText.indexOf("\n")?jQuery.parseJSON(i.responseText).result?(a.hasClass("column-description")?t.html(e.val()):t.text(e.val()),a.find(".dashicons-no").click(),a.addClass("responseSuccess").delay(2e3).queue(function(){jQuery(this).removeClass("responseSuccess").dequeue()}).delay(1100).queue(function(){jQuery(this).removeClass("trans").dequeue()})):(o(e),a.addClass("responseFail").delay(1100).queue(function(){jQuery(this).removeClass("responseFail").dequeue()}).delay(1100).queue(function(){jQuery(this).removeClass("trans").dequeue()})):(o(e),a.addClass("responseFail").delay(1100).queue(function(){jQuery(this).removeClass("responseFail").dequeue()}).delay(1100).queue(function(){jQuery(this).removeClass("trans").dequeue()}),console.log("Invalid response from server:"),console.log(i.responseText)))},jQuery(this).closest(".edit-controls").addClass("waiting"),i.send(s)}})});