!function(e,t){if("function"==typeof wp.media.collection){var i,r=wp.media;i=r.view.l10n="undefined"==typeof _wpMediaViewsL10n?{}:_wpMediaViewsL10n,jQuery.extend(i,DGl10n),r.controller.dgEdit=r.controller.Library.extend({defaults:{id:"dg-edit",title:i.editdgTitle,multiple:!1,searchable:!1,date:!1,sortable:!0,display:!1,content:"browse",toolbar:"dg-edit",describe:!0,displaySettings:!0,dragInfo:!0,idealColumnWidth:170,editing:!1,priority:60,syncSelection:!1},initialize:function(){this.get("library")||this.set("library",new r.model.Selection),this.get("AttachmentView")||this.set("AttachmentView",r.view.Attachment.EditLibrary),r.controller.Library.prototype.initialize.apply(this,arguments)},activate:function(){this.get("library");this.get("library").observe(wp.Uploader.queue),this.frame.on("content:render:browse",this.dgSettings,this),r.controller.Library.prototype.activate.apply(this,arguments)},deactivate:function(){this.get("library").unobserve(wp.Uploader.queue),this.frame.off("content:render:browse",this.dgSettings,this),r.controller.Library.prototype.deactivate.apply(this,arguments)},dgSettings:function(e){if(this.get("displaySettings")){var t=this.get("library");t&&e&&(t.dg=t.dg||new Backbone.Model,e.sidebar.set({dg:new r.view.Settings.dg({controller:this,model:t.dg,priority:40})}),e.toolbar.set("reverse",{text:i.reverseOrder,priority:80,click:function(){t.reset(t.toArray().reverse())}}))}}}),r.controller.dgAdd=r.controller.Library.extend({defaults:t.defaults({id:"dg-library",title:i.addTodgTitle,multiple:"add",filterable:"uploaded",menu:"dg",toolbar:"dg-add",priority:100,syncSelection:!1},r.controller.Library.prototype.defaults),initialize:function(){this.get("library")||this.set("library",r.query()),r.controller.Library.prototype.initialize.apply(this,arguments)},activate:function(){var e=this.get("library"),t=this.frame.state("dg-edit").get("library");this.editLibrary&&this.editLibrary!==t&&e.unobserve(this.editLibrary),e.validator=function(e){return!!this.mirroring.get(e.cid)&&!t.get(e.cid)&&r.model.Selection.prototype.validator.apply(this,arguments)},e.reset(e.mirroring.models,{silent:!0}),e.observe(t),this.editLibrary=t,r.controller.Library.prototype.activate.apply(this,arguments)}}),r.view.Settings.dg=r.view.Settings.extend({update:function(e){var t,i=this.model.get(e),r=this.$('[data-setting="'+e+'"]');r.length&&(r.is("select")?(t=r.find('[value="'+i+'"]')).length?(r.find("option").prop("selected",!1),t.prop("selected",!0)):this.model.set(e,r.find(":selected").val()):r.hasClass("button-group")?r.find("button").removeClass("active").filter('[value="'+i+'"]').addClass("active"):r.is('input[type="text"], input[type="number"], textarea')?r.is(":focus")||r.val(i):r.is('input[type="checkbox"]')&&r.prop("checked",!!i&&"false"!==i))},className:"collection-settings dg-settings",template:r.template("dg-settings")});var d=wp.media.view.MediaFrame.Post;wp.media.view.MediaFrame.Post=d.extend({initialize:function(){d.prototype.initialize.apply(this,arguments),this.states.add([new r.controller.Library({id:"dg",title:i.dgMenuTitle,priority:50,toolbar:"main-dg",filterable:"all",multiple:"add",editable:!1,library:r.query(this.options.library)}),new r.controller.dgEdit({library:this.options.selection,editing:this.options.editing,menu:"dg"}),new r.controller.dgAdd]),this.on("menu:create:dg",this.createMenu,this),this.on("toolbar:create:main-dg",this.createToolbar,this),this.on("menu:render:dg",this.dgMenu,this),this.on("toolbar:render:main-dg",this.maindgToolbar,this),this.on("toolbar:render:dg-edit",this.dgEditToolbar,this),this.on("toolbar:render:dg-add",this.dgAddToolbar,this)},dgMenu:function(e){var t=this.lastState(),d=t&&t.id,a=this;e.set({cancel:{text:i.canceldgTitle,priority:20,click:function(){d?a.setState(d):a.close(),this.controller.modal.focusManager.focus()}},separateCancel:new r.View({className:"separator",priority:40})})},maindgToolbar:function(e){var t=this;this.selectionStatusToolbar(e),e.set("dg",{style:"primary",text:i.dgButton,priority:60,requires:{selection:!0},click:function(){var e=t.state().get("selection"),i=t.state("dg-edit"),d=e.models;i.set("library",new r.model.Selection(d,{props:e.props.toJSON(),multiple:!0})),this.controller.setState("dg-edit"),this.controller.modal.focusManager.focus()}})},dgEditToolbar:function(){var e=this.state().get("editing");this.toolbar.set(new r.view.Toolbar({controller:this,items:{insert:{style:"primary",text:e?i.updatedg:i.insertdg,priority:80,requires:{library:!0},click:function(){var t=this.controller,i=t.state();t.close(),e?i.trigger("update",i.get("library")):wp.media.editor.insert(wp.media.dg.shortcode(i.get("library")).string().replace(/\sdgorder=/gi," order=").replace(/\sdgorderby=/gi," orderby=")),t.setState(t.options.state),t.reset(),"undefined"!=typeof tinyMCE&&null!==tinyMCE.activeEditor&&tinyMCE.activeEditor.fire("update.dg")}}}}))},dgAddToolbar:function(){this.toolbar.set(new r.view.Toolbar({controller:this,items:{insert:{style:"primary",text:i.addTodg,priority:80,requires:{selection:!0},click:function(){var e=this.controller,t=e.state();e.state("dg-edit").get("library").add(t.get("selection").models),t.trigger("reset"),e.setState("dg-edit")}}}}))}}),wp.media._dgDefaults={id:wp.media.view.settings.post&&wp.media.view.settings.post.id,columns:dgDefaults.columns,fancy:dgDefaults.fancy,relation:dgDefaults.relation,limit:dgDefaults.limit,mime_types:dgDefaults.mime_types,post_status:dgDefaults.post_status,post_type:dgDefaults.post_type,attachment_pg:dgDefaults.attachment_pg,descriptions:dgDefaults.descriptions,new_window:dgDefaults.new_window,paginate:dgDefaults.paginate,dgorder:dgDefaults.order,dgorderby:dgDefaults.orderby},wp.media.view.settings.dgDefaults?wp.media.dgDefaults=t.extend({},wp.media._dgDefaults,wp.media.view.settings.dgDefaults):wp.media.dgDefaults=wp.media._dgDefaults,wp.media.dg=new wp.media.collection({tag:"dg",editTitle:wp.media.view.l10n.editdgTitle,defaults:wp.media.dgDefaults,setDefaults:function(e){var i=this,r=!t.isEqual(wp.media.dgDefaults,wp.media._dgDefaults);return t.each(this.defaults,function(t,d){e[d]=i.coerce(e,d),t!==e[d]||r&&t!==wp.media._dgDefaults[d]||delete e[d]}),e}})}}(jQuery,_),void 0!==window.wp.mce&&void 0!==window.wp.mce.views&&function(e,t,i){var r;base={state:[],edit:function(e,t){if(-1==e.search(/\sids\s*=/gi)||e.search(/\s(?!(?:ids|attachment_pg|columns|new_window|descriptions|fancy|orderby|order|paginate|limit)\s*=)[\w\-]+\s*=/gi)>-1)tinyMCE.activeEditor.windowManager.alert(DGl10n.unfitSCalert);else{var r=this.type,d=i[r].edit(e.replace(/\sorder\s*=/gi," dgorder=").replace(/\sorderby\s*=/gi," dgorderby="));this.pausePlayers&&this.pausePlayers(),_.each(this.state,function(e){d.state(e).on("update",function(e){t(i[r].shortcode(e).string().replace(/\sdgorder=/gi," order=").replace(/\sdgorderby=/gi," orderby="),"dg"===r)})}),d.on("close",function(){d.detach()}),d.open()}}},r=_.extend({},base,{state:["dg-edit"],template:i.template("editor-dg"),initialize:function(){i.dg.attachments(this.shortcode,i.view.settings.post.id);var e=this.shortcode.attrs.named,t=this.text,r={};for(prop in e)t.indexOf(" "+prop+"=")>-1&&(r[prop]=e[prop]);t.indexOf(" dgorderby=")>-1&&(r.orderby=e.dgorderby),t.indexOf(" dgorder=")>-1&&(r.order=e.dgorder),this.render('<div data-shortcode="'+encodeURIComponent(JSON.stringify(r))+'"><div class="loading-placeholder"><div class="dashicons dashicons-admin-media"></div><div class="wpview-loading"><ins></ins></div></div></div>')}}),t.register("dg",_.extend({},r))}(window,window.wp.mce.views,window.wp.media,window.jQuery);